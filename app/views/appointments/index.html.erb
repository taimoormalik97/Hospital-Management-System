<div class="container pt-3"> 
  <div class="card">
    <div class="card-header p-3 container-fluid">
      <div class="row">
        <h3 class="col-md-10">Appointments</h3> 
        <% if current_user.patient? %>
          <div class="col-md-2 d-flex justify-content-md-end">
            <%= link_to 'Add', new_appointment_path,  {remote: true, 'data-toggle' =>  "modal", 'data-target' => '#exampleModal', class: 'btn btn-primary'} %>
            <%= render partial: "appointment_modal" %>   
          </div> 
        <% end %>  
      </div>
    </div> 
    <div class="card-body">
      <table  class="table">   
        <thead >   
          <tr>
            <th><%= t('appointment.label.date') %></th> 
            <th><%= t('appointment.label.start') %></th>   
            <th><%= t('appointment.label.end') %></th>
            <% if current_user.patient? %>   
              <th><%= t('doctor.name') %></th> 
              <th><%= t('appointment.label.status') %></th>
            <% elsif current_user.doctor? %>
              <th><%= t('patient.name') %></th>  
              <th></th>
            <% end %>
            <th></th>
          </tr>   
        </thead>   
        <tbody>   
          <% @appointments.each do |appointment| %>   
            <tr> 
              <td><%= appointment.date %></td>   
              <% availability = Availability.find(appointment.availability_id) %>
              <td><%= availability.start_slot.strftime("%I:%M%p") %></td>  
              <td><%= availability.end_slot.strftime("%I:%M%p") %></td>
              <% if current_user.patient? %>
                <td><%= Doctor.find(appointment.doctor_id).name %></td>
                <td><%= appointment.current_state.capitalize %></td> 
              <% elsif current_user.doctor? %>
                <td><%= Patient.find(appointment.patient_id).name %></td>
                <td>
                  <% if appointment.pending? %>
                    <%= link_to approve_appointment_path(appointment), method: 'put' do %>
                      <i class="far fa-check-circle color-ready" title="pending"></i>
                    <% end %>
                  <% elsif appointment.approved? %>
                    <%= link_to complete_appointment_path(appointment), method: 'put' do %>
                      <i class="far fa-check-circle color-notice" title="approved"></i>
                    <% end %>
                  <% elsif appointment.completed? %>
                      <i class="far fa-check-circle color-success" title="completed"></i>
                  <% end %>
                </td> 
              <% end %>
              <td>
                <% if appointment.pending? %>
                  <%= link_to appointment_path(appointment), method: :delete do %>
                    <i class="far fa-times-circle color-danger" title="cancel"></i>
                  <% end %>
                <% elsif appointment.approved? %>
                  <%= link_to "#" do %>
                    <i class="fas fa-pen color-primary-btn" title="prescription"></i>
                  <% end %>
                <% end %> 

              </td>       
            </tr>   
          <% end %>  
        </tbody>   
      </table> 
    </div>
  </div>
</div>
<div class="pagination justify-content-center" class="pagination-spacing">
  <%= will_paginate @appointments, previous_label: t('paginate.previous'), next_label: t('paginate.next') %> 
</div>
